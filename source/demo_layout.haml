!!! 5
-# paulirish.com/2008/conditional-stylesheets-vs-css-hacks-answer-neither/
<!--[if lt IE 7]> <html lang="en" class="no-js ie6 old-ie"> <![endif]-->
<!--[if IE 7]>    <html lang="en" class="no-js ie7 old-ie"> <![endif]-->
<!--[if IE 8]>    <html lang="en" class="no-js ie8 old-ie"> <![endif]-->
<!--[if gt IE 8]><!-->
%html.no-js{ :lang => "en" }
  <!--<![endif]-->
  %head
    %meta{ :charset => "utf-8" }/
    %meta{ "http-equiv" => "X-UA-Compatible", :content => "IE=edge,chrome=1" }/
    %title Fishpond
    %meta{ :name => "robots", :content => "noindex, nofollow" }/
    %meta{ :name => "keywords", :content => "" }/
    %meta{ :name => "viewport", :content => "width=device-width, maximum-scale=1.0" }/


    = stylesheet_link_tag "http://twitter.github.com/bootstrap/assets/css/bootstrap.css"
    = stylesheet_link_tag "http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.17/themes/cupertino/jquery-ui.css"

    :css
      body{
        padding-top: 100px;
      }

  %body
    = partial "shared/navbar"

    #loading.container
      .span4.offset4
        .progress.progress-striped.active
          .bar{:style => "width: 100%"}

    #auth.container.hide
      .span6.offset3
        %center
          %form{:class => "well form-inline"}
            %input#api_key.input-large{:type => "text", :placeholder => "API key"}
            %input#pond_token.input-small{:type => "text", :placeholder => "Pond Token"}
            %button.btn.btn-success{:type => "submit"}
              Connect

    #demo.container.hide
      = yield

    .container
      %hr
      %footer
        &copy; iFish 2012

    = javascript_include_tag "https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"
    = javascript_include_tag "https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.18/jquery-ui.min.js"
    = javascript_include_tag "http://twitter.github.com/bootstrap/assets/js/bootstrap-dropdown.js"
    = javascript_include_tag "http://ifish-prototype.herokuapp.com/assets/api/v1/fishpond.js"

    = yield_content :javascript

    :javascript
      $(function(){
        // Autofill auth form
        $("#auth form").each(function(){
          var form = $(this);
          var apiKeyInput = $("#api_key", form);
          var pondTokenInput = $("#pond_token", form);
          apiKeyInput.val(localStorage.getItem("fishpond_api_key"));
          pondTokenInput.val(localStorage.getItem("fishpond_pond_token"));
         });

        $("#auth").fadeIn(400);
        $("#loading").fadeOut(0);

        // Default Authentication setup
        $("#auth form").submit(function(e){
            e.preventDefault();
            var form = $(this);
            var apiKeyInput = $("#api_key", form);
            var pondTokenInput = $("#pond_token", form);
            var apiKey = apiKeyInput.val();
            var pondToken = pondTokenInput.val();
            var errors = [];

            if(apiKey.length != 41){
              errors.push("API key should be 41 characters long");
            }
            if(pondToken.length != 6){
              errors.push("Pond token should be 6 characters long");
            }

            if(errors.length > 0){
              alert("There were errors in your authentication: " + errors.join(", "));
            } else {
              $("#auth").fadeOut(0);
              $("#loading").fadeIn(400);
              localStorage.setItem("fishpond_api_key", apiKey);
              localStorage.setItem("fishpond_pond_token", pondToken);

              var options = { debug: true };
              var fishpond = new Fishpond(apiKey, options);
              setupFishpond(fishpond);
              fishpond.init(pondToken);
            }
        });
      });
