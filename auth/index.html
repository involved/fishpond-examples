<!DOCTYPE html>
<!--[if lt IE 7]> <html lang="en" class="no-js ie6 old-ie"> <![endif]-->
<!--[if IE 7]>    <html lang="en" class="no-js ie7 old-ie"> <![endif]-->
<!--[if IE 8]>    <html lang="en" class="no-js ie8 old-ie"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class='no-js' lang='en'>
<!--<![endif]-->
  <head>
    <meta charset='utf-8'>
    <meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
    <title>Fishpond</title>
    <meta content='noindex, nofollow' name='robots'>
    <meta content='' name='keywords'>
    <meta content='width=device-width, maximum-scale=1.0' name='viewport'>
    <link href="http://twitter.github.com/bootstrap/assets/css/bootstrap.css" media="screen" rel="stylesheet" type="text/css"/>
    <link href='http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.17/themes/cupertino/jquery-ui.css' rel='stylesheet'>

    <style>
      html{

      }

      body{
        padding-top: 40px;
      }
    </style>
  </head>

  <body>
    <div class="container" id="loading">
      <div class="span4 offset4">
        <div class="progress progress-striped active">
          <div class="bar" style="width: 100%"></div>
        </div>
      </div>
    </div>

    <div class='container hide' id="auth">
      <div class="span6 offset3">
        <center>
          <form class="well form-inline">
            <input id="api_key" type="text" class="input-large" placeholder="API key" />
            <input id="pond_token" type="text" class="input-small" placeholder="Pond Token" />
            <button type="submit" class="btn btn-success">Connect</button>
          </form>
        </center>
      </div>
    </div>

    <div class="container" class="demo">

    </div>

    <div class='container'>
      <hr>
      <footer>
      &copy; iFish 2012</footer>
    </div>

    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.18/jquery-ui.min.js"></script>
    <script src="http://ifish-prototype.herokuapp.com/assets/api/v1/fishpond.js" type="text/javascript"></script>

    <script type="text/javascript">
      $(function(){
        // Autofill auth form
        $("#auth form").each(function(){
          var form = $(this);
          var apiKeyInput = $("#api_key", form);
          var pondTokenInput = $("#pond_token", form);
          apiKeyInput.val(localStorage.getItem("fishpond_api_key"));
          pondTokenInput.val(localStorage.getItem("fishpond_pond_token"));
         });

        $("#auth").fadeIn(400);
        $("#loading").fadeOut(0);

        // Default Authentication setup
        $("#auth form").submit(function(e){
            e.preventDefault();
            var form = $(this);
            var apiKeyInput = $("#api_key", form);
            var pondTokenInput = $("#pond_token", form);
            var apiKey = apiKeyInput.val();
            var pondToken = pondTokenInput.val();
            var errors = [];

            if(apiKey.length != 41){
              errors.push("API key should be 41 characters long");
            }
            if(pondToken.length != 6){
              errors.push("Pond token should be 6 characters long");
            }

            if(errors.length > 0){
              alert("There were errors in your authentication: " + errors.join(", "));
            } else {
              $("#auth").fadeOut(0);
              $("#loading").fadeIn(400);
              localStorage.setItem("fishpond_api_key", apiKey);
              localStorage.setItem("fishpond_pond_token", pondToken);

              var options = { development: false, debug: false};
              var fishpond = new Fishpond(apiKey, options);


              fishpond.resultsUpdated(function(results){

              });

              fishpond.ready(function(pond){

              });

              fishpond.init(pondToken);
            }
        });
      });
    </script>
  </body>
</html>

