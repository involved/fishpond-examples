<!DOCTYPE html>
<!--[if lt IE 7]> <html lang="en" class="no-js ie6 old-ie"> <![endif]-->
<!--[if IE 7]>    <html lang="en" class="no-js ie7 old-ie"> <![endif]-->
<!--[if IE 8]>    <html lang="en" class="no-js ie8 old-ie"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class='no-js' lang='en'>
  <!--<![endif]-->
  <head>
    <meta charset='utf-8' />
    <meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible' />
    <title>Fishpond</title>
    <meta content='noindex, nofollow' name='robots' />
    <meta content='' name='keywords' />
    <meta content='width=device-width, maximum-scale=1.0' name='viewport' />
    <link href="http://twitter.github.com/bootstrap/assets/css/bootstrap.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.17/themes/cupertino/jquery-ui.css" media="screen" rel="stylesheet" type="text/css" />
    <style type='text/css'>
      /*<![CDATA[*/
        body{
          padding-top: 100px;
        }
      /*]]>*/
    </style>
    <style type='text/css'>
      /*<![CDATA[*/
        #demo{
          height: 700px;
          position: relative;
        }
        
        form#query{
          position: absolute;
          width: 131px;
          height: 107px;
          padding: 40px 28px;
          left: 376px;
          top: 256px;
          background: url("/images/atom/background-large.png");
        }
        
        form#query > div{
          margin: 5px 0 5px 10px
        }
        
        form#query .criteria{
          color: #FFF;
          font-weight: bold;
          font-size: 9px;
          line-height: 9px;
          text-transform: uppercase;
          text-align: center;
          width: 50px;
          display: inline-block;
        }
        
        #controls{
          position: absolute;
          top: 0;
          left: 0;
        }
        
        
        ul#results{
          list-style: none;
          padding: 0;
          margin: 0;
          position: absolute;
          top: 0;
          bottom: 0;
          left: 0;
          right: 0;
          overflow: hidden;
        }
        
        ul#results li{
          position: absolute;
          width: 70px;
          height: 70px;
          padding: 13px;
          text-align: center;
          overflow: hidden;
          background: url("/images/atom/background-small.png");
          color: #FFF;
          font-weight: bold;
          font-size: 9px;
          text-transform: uppercase;
        
        }
      /*]]>*/
    </style>
  </head>
  <body>
    <div class='navbar navbar-fixed-top'>
      <div class='navbar-inner'>
        <div class='container'>
          <a class='brand' href='/'>Fishpond Examples</a>
          <ul class='nav'>
            <li class='dropdown'>
              <a class='dropdown-toggle' data-toggle='dropdown' href='#'>
                Demos
                <b class='caret'></b>
              </a>
              <ul class='dropdown-menu'>
                <li><a href="/fishpond-examples/demos/atom">atom</a></li>
                <li><a href="/fishpond-examples/demos/basic-dynamic">basic-dynamic</a></li>
                <li><a href="/fishpond-examples/demos/basic-html5">basic-html5</a></li>
                <li><a href="/fishpond-examples/demos/basic-static">basic-static</a></li>
                <li><a href="/fishpond-examples/demos/dial">dial</a></li>
                <li><a href="/fishpond-examples/demos/flotr">flotr</a></li>
                <li><a href="/fishpond-examples/demos/quicksand">quicksand</a></li>
                <li><a href="/fishpond-examples/demos/scaffold">scaffold</a></li>
                <li><a href="/fishpond-examples/demos/spider-graph">spider-graph</a></li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div class='container' id='loading'>
      <div class='span4 offset4'>
        <div class='progress progress-striped active'>
          <div class='bar' style='width: 100%'></div>
        </div>
      </div>
    </div>
    <div class='container hide' id='auth'>
      <div class='span6 offset3'>
        <center>
          <form class='well form-inline'>
            <input class='input-large' id='api_key' placeholder='API key' type='text' />
            <input class='input-small' id='pond_token' placeholder='Pond Token' type='text' />
            <button class='btn btn-success' type='submit'>
              Connect
            </button>
          </form>
        </center>
      </div>
    </div>
    <div class='container hide' id='demo'>
      <ul id='results'></ul>
      <form id='query'>
        <input data-tag='quantitative' type='hidden' value='6' />
        <input data-tag='pure' type='hidden' value='6' />
        <input data-tag='biological' type='hidden' value='6' />
        <input data-tag='indoors' type='hidden' value='6' />
        <div>
          <button class='btn btn-mini' data-target='quantitative' data-value='-1'>
            <i class='icon-minus-sign'></i>
          </button>
          <span class='criteria'>Quant.</span>
          <button class='btn btn-mini' data-target='quantitative' data-value='1'>
            <i class='icon-plus-sign'></i>
          </button>
        </div>
        <div>
          <button class='btn btn-mini' data-target='pure' data-value='-1'>
            <i class='icon-minus-sign'></i>
          </button>
          <span class='criteria'>Pure</span>
          <button class='btn btn-mini' data-target='pure' data-value='1'>
            <i class='icon-plus-sign'></i>
          </button>
        </div>
        <div>
          <button class='btn btn-mini' data-target='biological' data-value='-1'>
            <i class='icon-minus-sign'></i>
          </button>
          <span class='criteria'>Biology</span>
          <button class='btn btn-mini' data-target='biological' data-value='1'>
            <i class='icon-plus-sign'></i>
          </button>
        </div>
        <div>
          <button class='btn btn-mini' data-target='indoors' data-value='-1'>
            <i class='icon-minus-sign'></i>
          </button>
          <span class='criteria'>Indoors</span>
          <button class='btn btn-mini' data-target='indoors' data-value='1'>
            <i class='icon-plus-sign'></i>
          </button>
        </div>
      </form>
      <div id='controls'>
        <button class='btn play'>
          <i class='icon-play'></i>
        </button>
        <button class='btn pause'>
          <i class='icon-pause'></i>
        </button>
      </div>
    </div>
    <div class='container'>
      <hr />
      <footer>
        &copy; iFish 2012
      </footer>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.18/jquery-ui.min.js" type="text/javascript"></script>
    <script src="http://twitter.github.com/bootstrap/assets/js/bootstrap-dropdown.js" type="text/javascript"></script>
    <script src="http://twitter.github.com/bootstrap/assets/js/bootstrap-modal.js" type="text/javascript"></script>
    <script src="http://ifish-prototype.herokuapp.com/assets/api/v1/fishpond.js" type="text/javascript"></script>
    <script src="https://raw.github.com/yeco/jquery-ui-touch-punch/master/jquery.ui.touch-punch.min.js" type="text/javascript"></script>
    <script src="/javascripts/jquery-css-transform.js" type="text/javascript"></script>
    <script src="/javascripts/jquery-animate-css-rotate-scale.js" type="text/javascript"></script>
    <script type='text/javascript'>
      //<![CDATA[
        var animationInterval;
        var time = 0;
        var targetFPS = 60;
        var lastFrameTime = 0;
        var initialOrbitalSize = 6;
        var orbitalMultiplier = 2.2;
        var initialRadius = 190;
        var radiusMultiplier = 1.6;
        var scaleMultiplier = 0.7;
        var initialSpeed = 0.5; // in degrees/second
        var speedMultiplier = 1.2;
        var orbitalCutoff = 3;
        var maximumVelocity = 50;
        
        var demoCanvas = $("#demo");
        var resultsCanvas = $("ul#results");
        
        var gravX = 470;
        var gravY = 350;
        var mouseD = 0;
        
        function updateMousePosition(e){
          var xd = Math.abs(e.pageX - $(document).innerWidth()/2);
          var yd = Math.abs(e.pageY - $(document).innerHeight()/2);
        
          mouseD = Math.sqrt((xd * xd) + (yd * yd));
        };
        
        function updateAnimation(){
          var markerTime = (new Date()).getTime();
          var elapsedTime = markerTime - lastFrameTime;
          var frames = Math.round(elapsedTime / ((1/targetFPS)*1000));
          time += frames;
          lastFrameTime = markerTime;
        
          for(var currentOrbitalIndex = 0; currentOrbitalIndex <= orbitalCutoff + 1; currentOrbitalIndex ++){
        
            var particles = resultsCanvas.find("li[data-orbital='" + (currentOrbitalIndex + 1) + "']");
            var particleIndex = 0;
            var speed = initialSpeed * Math.pow(speedMultiplier, currentOrbitalIndex);
            var orbitalRadius = initialRadius * Math.pow(radiusMultiplier, currentOrbitalIndex);
            var scale1 = Math.pow(scaleMultiplier, currentOrbitalIndex);
        
            if(currentOrbitalIndex >= orbitalCutoff) speed = 0;
            //if(Math.abs(mouseD - orbitalRadius) < 50) speed = 0;
        
            particles.each(function(){
              var particle = $(this);
        
              var currentVelocityX = parseInt(particle.attr('data-vel-x'));
              if(isNaN(currentVelocityX)){
                currentVelocityX = 1.5;
              }
              var currentVelocityY = parseInt(particle.attr('data-vel-y'));
              if(isNaN(currentVelocityY)){
                currentVelocityY = 1.5;
              }
              var degrees = (time * speed) % 360;
              degrees -= (360/particles.length) * particleIndex;
              var radians = degrees * (Math.PI/180);
              var x0 = parseInt(particle.css('left').split("px")[0]);
              var y0 = parseInt(particle.css('top').split("px")[0]);
              var x1 = orbitalRadius * Math.cos(radians);
              var y1 = orbitalRadius * Math.sin(radians);
              x1 += gravX - 48 + 10;
              y1 += gravY - 48 + 10;
        
              var xd = x1 - x0;
              var yd = y1 - y0;
        
              if(Math.abs(xd) > currentVelocityX){
                currentVelocityX *= 1.1;
              } else if (currentVelocityX > 1){
                currentVelocityX /= 1.1;
              }
        
              if(Math.abs(yd) > currentVelocityY){
                currentVelocityY *= 1.1;
              } else if (currentVelocityY > 1){
                currentVelocityY /= 1.1;
              }
        
              var xEased = x0 + (xd/(50/currentVelocityX));
              var yEased = y0 + (yd/(50/currentVelocityY));
        
              var scale0 = parseFloat(particle.scale());
              var scaleEased = scale0 + ((scale1 - scale0)/50);
        
              particle.css({left: xEased + "px", top: yEased + "px"});
              particle.scale(scaleEased);
              particleIndex++;
            });
          }
        };
        
        function startAnimation(){
          if(animationInterval == undefined){
            lastFrameTime = (new Date()).getTime();
            animationInterval = setInterval(updateAnimation, (1/targetFPS)*1000);
          }
        };
        
        function pauseAnimation(){
          clearInterval(animationInterval);
          animationInterval = undefined;
        };
        
        function orbitalSize(orbital){
          return Math.pow(orbitalMultiplier, orbital - 1) * initialOrbitalSize;
        }
        
        var setupFishpond = function(fishpond){ // you must define this function in your demo, if you want hooks to the fishpond
        
          fishpond.resultsUpdated(function(results){
            var currentOrbitalIndex = 0;
            var currentOribtalSize = 0;
        
            resultsCanvas.find("li").each(function(){
              $(this).attr('data-orbital', orbitalCutoff + 1);
            });
        
            for(var i = 0; i < results.length; i++){
              var result = results[i];
              var fish = result.fish;
        
              var li = resultsCanvas.find("li[data-id='" + fish.id + "']");
              if(li.length == 0){
                var li = $("<li></li>");
              }
        
              if(currentOribtalSize + 1 > orbitalSize(currentOrbitalIndex + 1) && currentOrbitalIndex + 1 <= orbitalCutoff){
                currentOrbitalIndex++;
                currentOribtalSize = 0;
              }
        
              li.html(fish.title);
              li.attr('data-id', fish.id);
              li.attr('data-orbital', currentOrbitalIndex + 1);
              li.attr('data-score', result.score);
        
              if(resultsCanvas.find("li[data-id='" + fish.id + "']").length == 0){
                li.scale(1.0);
                li.css({left: gravX + "px", top: gravY + "px"});
                resultsCanvas.append(li);
              }
              currentOribtalSize++;
            }
          });
        
          fishpond.ready(function(pond){
            $("#loading").fadeOut(0);
            $("#demo").fadeIn(400);
            $("#query .btn").each(function(){
              $(this).click(function(e){
                e.preventDefault();
                var btn = $(this);
                var input = $("#query input[data-tag='" + btn.attr('data-target') + "']");
                input.val(parseInt(input.val()) + parseInt(btn.attr('data-value')));
        
                if(input.val() < 1) input.val(1);
                if(input.val() > 11) input.val(11);
        
                fishpond.query({
                  quantitative: $("#query input[data-tag='quantitative']").val(),
                  pure: $("#query input[data-tag='pure']").val(),
                  biological: $("#query input[data-tag='biological']").val(),
                  indoors: $("#query input[data-tag='indoors']").val()
                }, {});
              });
            });
        
            $(".btn.play").click(function(e){
              e.preventDefault();
              startAnimation();
            });
            $(".btn.pause").click(function(e){
              e.preventDefault();
              pauseAnimation();
            });
        
            $("#results").mousemove(updateMousePosition);
        
            startAnimation();
            fishpond.query({}, {});
          });
        
          fishpond.loading(function(percent){
            console.log("Demo loading " + (percent * 100) + "%");
          });
        
        };
      //]]>
    </script>
    <script type='text/javascript'>
      //<![CDATA[
        $(function(){
          // Autofill auth form
          $("#auth form").each(function(){
            var form = $(this);
            var apiKeyInput = $("#api_key", form);
            var pondTokenInput = $("#pond_token", form);
            apiKeyInput.val(localStorage.getItem("fishpond_api_key"));
            pondTokenInput.val(localStorage.getItem("fishpond_pond_token"));
           });
        
          $("#auth").fadeIn(400);
          $("#loading").fadeOut(0);
        
          // Default Authentication setup
          $("#auth form").submit(function(e){
              e.preventDefault();
              var form = $(this);
              var apiKeyInput = $("#api_key", form);
              var pondTokenInput = $("#pond_token", form);
              var apiKey = apiKeyInput.val();
              var pondToken = pondTokenInput.val();
              var errors = [];
        
              if(apiKey.length != 41){
                errors.push("API key should be 41 characters long");
              }
              if(pondToken.length != 6){
                errors.push("Pond token should be 6 characters long");
              }
        
              if(errors.length > 0){
                alert("There were errors in your authentication: " + errors.join(", "));
              } else {
                $("#auth").fadeOut(0);
                $("#loading").fadeIn(400);
                localStorage.setItem("fishpond_api_key", apiKey);
                localStorage.setItem("fishpond_pond_token", pondToken);
        
                var options = { debug: true };
                var fishpond = new Fishpond(apiKey, options);
                setupFishpond(fishpond);
                fishpond.init(pondToken);
              }
          });
        });
      //]]>
    </script>
  </body>
</html>
