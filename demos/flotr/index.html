<!DOCTYPE html>
<!--[if lt IE 7]> <html lang="en" class="no-js ie6 old-ie"> <![endif]-->
<!--[if IE 7]>    <html lang="en" class="no-js ie7 old-ie"> <![endif]-->
<!--[if IE 8]>    <html lang="en" class="no-js ie8 old-ie"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class='no-js' lang='en'>
  <!--<![endif]-->
  <head>
    <meta charset='utf-8' />
    <meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible' />
    <title>Fishpond</title>
    <meta content='noindex, nofollow' name='robots' />
    <meta content='' name='keywords' />
    <meta content='width=device-width, maximum-scale=1.0' name='viewport' />
    <link href="http://twitter.github.com/bootstrap/assets/css/bootstrap.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.17/themes/cupertino/jquery-ui.css" media="screen" rel="stylesheet" type="text/css" />
    <style type='text/css'>
      /*<![CDATA[*/
        body{
          padding-top: 100px;
        }
      /*]]>*/
    </style>
    
  </head>
  <body>
    <div class='navbar navbar-fixed-top'>
      <div class='navbar-inner'>
        <div class='container'>
          <a class='brand' href='/'>Fishpond Examples</a>
          <ul class='nav'>
            <li class='dropdown'>
              <a class='dropdown-toggle' data-toggle='dropdown' href='#'>
                Demos
                <b class='caret'></b>
              </a>
              <ul class='dropdown-menu'>
                <li><a href="/demos/atom">atom</a></li>
                <li><a href="/demos/basic">basic</a></li>
                <li><a href="/demos/basic-html5">basic-html5</a></li>
                <li><a href="/demos/flotr">flotr</a></li>
                <li><a href="/demos/quicksand">quicksand</a></li>
                <li><a href="/demos/scaffold">scaffold</a></li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div class='container' id='loading'>
      <div class='span4 offset4'>
        <div class='progress progress-striped active'>
          <div class='bar' style='width: 100%'></div>
        </div>
      </div>
    </div>
    <div class='container hide' id='auth'>
      <div class='span6 offset3'>
        <center>
          <form class='well form-inline'>
            <input class='input-large' id='api_key' placeholder='API key' type='text' />
            <input class='input-small' id='pond_token' placeholder='Pond Token' type='text' />
            <button class='btn btn-success' type='submit'>
              Connect
            </button>
          </form>
        </center>
      </div>
    </div>
    <div class='container hide' id='demo'>
      <div class='page-header'>
        <h1>Flotr Demo</h1>
        <br />
        <p>using the <a href="https://github.com/HumbleSoftware/Flotr2">Flotr</a> Canvas Graphing Library</p>
      </div>
      <div class='row'>
        <div class='span5'>
          <div class='well'>
            <h2>Tags</h2>
            <form class='form-horizontal'>
              <fieldset>
                <div class='control-group'>
                  <label class='control-label'>Quantitative (6)</label>
                  <div class='controls'>
                    <input data-slug='quantitative' id='query_tags_gwx' name='query[tags][gwx]' type='hidden' value='6' />
                    <div class='slider span2' data-target='query[tags][gwx]'></div>
                  </div>
                </div>
                <div class='control-group'>
                  <label class='control-label'>Biological (6)</label>
                  <div class='controls'>
                    <input data-slug='biological' id='query_tags_Ymp' name='query[tags][Ymp]' type='hidden' value='6' />
                    <div class='slider span2' data-target='query[tags][Ymp]'></div>
                  </div>
                </div>
                <div class='control-group'>
                  <label class='control-label'>Pure (6)</label>
                  <div class='controls'>
                    <input data-slug='pure' id='query_tags_WxI' name='query[tags][WxI]' type='hidden' value='6' />
                    <div class='slider span2' data-target='query[tags][WxI]'></div>
                  </div>
                </div>
                <div class='control-group'>
                  <label class='control-label'>Indoors (6)</label>
                  <div class='controls'>
                    <input data-slug='indoors' id='query_tags_CjC' name='query[tags][CjC]' type='hidden' value='6' />
                    <div class='slider span2' data-target='query[tags][CjC]'></div>
                  </div>
                </div>
                <div class='control-group'>
                  <label class='control-label'>Dunno (6)</label>
                  <div class='controls'>
                    <input data-slug='dunno' id='query_tags_2TE' name='query[tags][2TE]' type='hidden' value='6' />
                    <div class='slider span2' data-target='query[tags][2TE]'></div>
                  </div>
                </div>
              </fieldset>
            </form>
            <h2>Filters</h2>
            <p>
              <em>No filters defined.</em>
            </p>
          </div>
        </div>
        <div class='span6 offset1' id='radar'></div>
      </div>
      <div class='row'>
        <div class='span12' id='results'>
          <h2>Results</h2>
          <ul class='thumbnails results'></ul>
        </div>
      </div>
      <script src="http://humblesoftware.com/static/js/hsd-flotr2.js" type="text/javascript"></script>
      <style type='text/css'>
        /*<![CDATA[*/
          #radar{
          
            height: 350px;
            
          }
        /*]]>*/
      </style>
    </div>
    <div class='container'>
      <hr />
      <footer>
        &copy; iFish 2012
      </footer>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.18/jquery-ui.min.js" type="text/javascript"></script>
    <script src="http://twitter.github.com/bootstrap/assets/js/bootstrap-dropdown.js" type="text/javascript"></script>
    <script src="http://ifish-prototype.herokuapp.com/assets/api/v1/fishpond.js" type="text/javascript"></script>
    <script type='text/javascript'>
      //<![CDATA[
        var setupFishpond = function(fishpond){ // you must define this function in your demo, if you want hooks to the fishpond
        
          fishpond.resultsUpdated(function(results){
            console.log(results);
            for(var i = 0; i < results.length; i++){
              var li = $("<li></li>");
              var thumbnail = $("<div></div>");
              thumbnail.html(results[i].fish.title);
              thumbnail.addClass("thumbnail");
        
              if(i < 2){
                li.addClass("span6");
              } else if (i < 6) {
                li.addClass("span3");
              } else {
                li.addClass("span2");
              }
              li.append(thumbnail);
              $(".results").append(li);
            }
          });
        
          fishpond.ready(function(pond){
            $("#loading").fadeOut(0);
            $("#demo").fadeIn(400);
            $("#demo h1").append(' "' + pond.name + '"');
            fishpond.query({}, {});
        
            demo.init();
          });
        
          fishpond.loading(function(percent){
            $("#loading .progress").removeClass("progress-striped");
            $("#loading .bar").css({width: (percent * 100) + "%"});
          });
        
        };
        
        demo = {
          init: function () { 
            console.log("[Demo][init]");
            var container = document.getElementById("radar");
            
            demo.ui.sliders();
            demo.flotr.basic_radar(container);
          },
        
          //////////////////////////////////////////////////////////////////////////
          ui: {
            sliders: function () {
              $(".slider").slider({
                value: 6,
                min: 1,
                max: 11,
                step: 0.1,
                slide: function(e, ui){
                  var label = $(this).parents('.control-group').find('label');
                  var hiddenField = $("input[name='" + $(this).data('target') + "']");
                  var value = Math.round(Math.abs(12 - ui['value']));
        
                  if(value.toString() != hiddenField.val().toString()){
                    hiddenField.val(value);
                    label.html(label.html().split("(")[0] + " (" + value.toString() + ")");
        
                    var tags = {};
                    var filters = {};
                    $("form input").each(function(){
                      tags[$(this).data('slug')] = $(this).val();
                    });
                    //fishpond.query(tags, filters);
                  }
                }
              });
            }
          },
        
          //////////////////////////////////////////////////////////////////////////
          flotr: {
            basic_radar: function (container) {
              console.log("[Demo][Flotr][Basic Radar]");
            
              var
                s1 = { label : false, data : [[0, 3], [1, 8], [2, 5], [3, 5], [4, 3], [5, 9]] },
                graph, ticks;
        
              // Radar Labels
              ticks = [
                [0, "Statutory"],
                [1, "External"],
                [2, "Videos"],
                [3, "Yippy"],
                [4, "Management"],
                [5, "oops"]
              ];
                
              // Draw the graph.
              graph = Flotr.draw(container, [ s1 ], {
                radar : { show : true}, 
                grid  : { circular : true, minorHorizontalLines : false, horizontalLines : false, verticalLines : true}, 
                yaxis : { min : 0, max : 10, minorTickFreq : 2, showLabels : false}, 
                xaxis : { ticks : ticks}
              });
            }
          }
        }
      //]]>
    </script>
    <script type='text/javascript'>
      //<![CDATA[
        $(function(){
          // Autofill auth form
          $("#auth form").each(function(){
            var form = $(this);
            var apiKeyInput = $("#api_key", form);
            var pondTokenInput = $("#pond_token", form);
            apiKeyInput.val(localStorage.getItem("fishpond_api_key"));
            pondTokenInput.val(localStorage.getItem("fishpond_pond_token"));
           });
        
          $("#auth").fadeIn(400);
          $("#loading").fadeOut(0);
        
          // Default Authentication setup
          $("#auth form").submit(function(e){
              e.preventDefault();
              var form = $(this);
              var apiKeyInput = $("#api_key", form);
              var pondTokenInput = $("#pond_token", form);
              var apiKey = apiKeyInput.val();
              var pondToken = pondTokenInput.val();
              var errors = [];
        
              if(apiKey.length != 41){
                errors.push("API key should be 41 characters long");
              }
              if(pondToken.length != 6){
                errors.push("Pond token should be 6 characters long");
              }
        
              if(errors.length > 0){
                alert("There were errors in your authentication: " + errors.join(", "));
              } else {
                $("#auth").fadeOut(0);
                $("#loading").fadeIn(400);
                localStorage.setItem("fishpond_api_key", apiKey);
                localStorage.setItem("fishpond_pond_token", pondToken);
        
                var options = { debug: true };
                var fishpond = new Fishpond(apiKey, options);
                setupFishpond(fishpond);
                fishpond.init(pondToken);
              }
          });
        });
      //]]>
    </script>
  </body>
</html>
